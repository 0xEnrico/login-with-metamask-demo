(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{199:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},201:function(e,t,n){e.exports=n(520)},208:function(e,t,n){},221:function(e,t){},223:function(e,t){},314:function(e,t){},387:function(e,t){},510:function(e,t,n){},514:function(e,t,n){},518:function(e,t,n){},520:function(e,t,n){"use strict";n.r(t);var a=n(2),o=n(196),r=n(197),i=(n(208),n(39)),s=n(40),c=n(42),u=n(41),l=n(43),h=n(54),d=n.n(h),p=n(108),m=n(198),g=n.n(m),f=(n(510),void 0),b=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={loading:!1},n.handleAuthenticate=function(e){var t=e.publicAddress,n=e.signature;return fetch("".concat("https://login-with-metamask.now.sh/api","/auth"),{body:JSON.stringify({publicAddress:t,signature:n}),headers:{"Content-Type":"application/json"},method:"POST"}).then(function(e){return e.json()})},n.handleClick=Object(p.a)(d.a.mark(function e(){var t,a,o;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.props.onLoggedIn,window.ethereum){e.next=4;break}return window.alert("Please install MetaMask first."),e.abrupt("return");case 4:if(f){e.next=15;break}return e.prev=5,e.next=8,window.ethereum.enable();case 8:f=new g.a(window.ethereum),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),window.alert("You need to allow MetaMask."),e.abrupt("return");case 15:return e.next=17,f.eth.getCoinbase();case 17:if(a=e.sent){e.next=21;break}return window.alert("Please activate MetaMask first."),e.abrupt("return");case 21:o=a.toLowerCase(),n.setState({loading:!0}),fetch("".concat("https://login-with-metamask.now.sh/api","/users?publicAddress=").concat(o)).then(function(e){return e.json()}).then(function(e){return e.length?e[0]:n.handleSignup(o)}).then(n.handleSignMessage).then(n.handleAuthenticate).then(t).catch(function(e){window.alert(e),n.setState({loading:!1})});case 24:case"end":return e.stop()}},e,null,[[5,11]])})),n.handleSignMessage=function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a,o;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.publicAddress,a=t.nonce,e.prev=1,e.next=4,f.eth.personal.sign("I am signing my one-time nonce: ".concat(a),n,"");case 4:return o=e.sent,e.abrupt("return",{publicAddress:n,signature:o});case 8:throw e.prev=8,e.t0=e.catch(1),new Error("You need to sign the message to be able to log in.");case 11:case"end":return e.stop()}},e,null,[[1,8]])}));return function(t){return e.apply(this,arguments)}}(),n.handleSignup=function(e){return fetch("".concat("https://login-with-metamask.now.sh/api","/users"),{body:JSON.stringify({publicAddress:e}),headers:{"Content-Type":"application/json"},method:"POST"}).then(function(e){return e.json()})},n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.state.loading;return a.createElement("div",null,a.createElement("p",null,"Please select your login method.",a.createElement("br",null),"For the purpose of this demo, only MetaMask login is implemented."),a.createElement("button",{className:"Login-button Login-mm",onClick:this.handleClick},e?"Loading...":"Login with MetaMask"),a.createElement("button",{className:"Login-button Login-fb",disabled:!0},"Login with Facebook"),a.createElement("button",{className:"Login-button Login-email",disabled:!0},"Login with Email"))}}]),t}(a.Component),w=n(199),v=n.n(w),k=n(200),y=n.n(k),E=(n(514),n(515)),O=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={loading:!1,user:void 0,username:""},n.handleChange=function(e){var t=e.target.value;n.setState({username:t})},n.handleSubmit=function(){var e=n.props.auth.accessToken,t=n.state,a=t.user,o=t.username;n.setState({loading:!0}),a?fetch("".concat("https://login-with-metamask.now.sh/api","/users/").concat(a.id),{body:JSON.stringify({username:o}),headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},method:"PATCH"}).then(function(e){return e.json()}).then(function(e){return n.setState({loading:!1,user:e})}).catch(function(e){window.alert(e),n.setState({loading:!1})}):window.alert("The user id has not been fetched yet. Please try again in 5 seconds.")},n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.auth.accessToken,n=E(t).payload.id;fetch("".concat("https://login-with-metamask.now.sh/api","/users/").concat(n),{headers:{Authorization:"Bearer ".concat(t)}}).then(function(e){return e.json()}).then(function(t){return e.setState({user:t})}).catch(window.alert)}},{key:"render",value:function(){var e=this.props,t=e.auth.accessToken,n=e.onLoggedOut,o=E(t).payload.publicAddress,r=this.state,i=r.loading,s=r.user,c=s&&s.username;return a.createElement("div",{className:"Profile"},a.createElement("p",null,"Logged in as ",a.createElement(y.a,{seed:o})),a.createElement("div",null,"My username is ",c?a.createElement("pre",null,c):"not set."," My publicAddress is ",a.createElement("pre",null,o)),a.createElement("div",null,a.createElement("label",{htmlFor:"username"},"Change username: "),a.createElement("input",{name:"username",onChange:this.handleChange}),a.createElement("button",{disabled:i,onClick:this.handleSubmit},"Submit")),a.createElement("p",null,a.createElement("button",{onClick:n},"Logout")))}}]),t}(a.Component),S=(n(518),"login-with-metamask:auth"),j=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},n.handleLoggedIn=function(e){localStorage.setItem(S,JSON.stringify(e)),n.setState({auth:e})},n.handleLoggedOut=function(){localStorage.removeItem(S),n.setState({auth:void 0})},n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=window.localStorage.getItem(S),t=e&&JSON.parse(e);this.setState({auth:t})}},{key:"render",value:function(){var e=this.state.auth;return a.createElement("div",{className:"App"},a.createElement("header",{className:"App-header"},a.createElement("img",{src:v.a,className:"App-logo",alt:"logo"}),a.createElement("h1",{className:"App-title"},"Welcome to Login with MetaMask Demo")),a.createElement("div",{className:"App-intro"},e?a.createElement(O,{auth:e,onLoggedOut:this.handleLoggedOut}):a.createElement(b,{onLoggedIn:this.handleLoggedIn})))}}]),t}(a.Component);Object(r.config)({path:".env.production"}),o.render(a.createElement(j,null),document.getElementById("root"))}},[[201,1,2]]]);
//# sourceMappingURL=main.af3b58df.chunk.js.map