(this["webpackJsonp@login-with-metamask/frontend"]=this["webpackJsonp@login-with-metamask/frontend"]||[]).push([[0],{141:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},142:function(e,t,n){e.exports=n(365)},143:function(e,t,n){},150:function(e,t,n){},152:function(e,t,n){},162:function(e,t){},185:function(e,t){},187:function(e,t){},250:function(e,t){},359:function(e,t,n){},365:function(e,t,n){"use strict";n.r(t);n(143);var a=n(137),s=n(3),o=n.n(s),r=n(138),i=n.n(r),c=(n(150),n(14)),l=n.n(c),h=n(66),u=(n(152),n(139)),d=n.n(u);let m=void 0;class p extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={loading:!1},this.handleAuthenticate=({publicAddress:e,signature:t})=>fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/auth"),{body:JSON.stringify({publicAddress:e,signature:t}),headers:{"Content-Type":"application/json"},method:"POST"}).then(e=>e.json()),this.handleClick=Object(h.a)(l.a.mark((function e(){var n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.props.onLoggedIn,window.ethereum){e.next=4;break}return window.alert("Please install MetaMask first."),e.abrupt("return");case 4:if(m){e.next=15;break}return e.prev=5,e.next=8,window.ethereum.enable();case 8:m=new d.a(window.ethereum),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),window.alert("You need to allow MetaMask."),e.abrupt("return");case 15:return e.next=17,m.eth.getCoinbase();case 17:if(a=e.sent){e.next=21;break}return window.alert("Please activate MetaMask first."),e.abrupt("return");case 21:s=a.toLowerCase(),t.setState({loading:!0}),fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/users?publicAddress=").concat(s)).then(e=>e.json()).then(e=>e.length?e[0]:t.handleSignup(s)).then(t.handleSignMessage).then(t.handleAuthenticate).then(n).catch(e=>{window.alert(e),t.setState({loading:!1})});case 24:case"end":return e.stop()}}),e,null,[[5,11]])}))),this.handleSignMessage=function(){var e=Object(h.a)(l.a.mark((function e({publicAddress:t,nonce:n}){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.eth.personal.sign("I am signing my one-time nonce: ".concat(n),t,"");case 3:return a=e.sent,e.abrupt("return",{publicAddress:t,signature:a});case 7:throw e.prev=7,e.t0=e.catch(0),new Error("You need to sign the message to be able to log in.");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),this.handleSignup=e=>fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/users"),{body:JSON.stringify({publicAddress:e}),headers:{"Content-Type":"application/json"},method:"POST"}).then(e=>e.json())}render(){const e=this.state.loading;return(o.a.createElement("div",null,o.a.createElement("p",null,"Please select your login method.",o.a.createElement("br",null),"For the purpose of this demo, only MetaMask login is implemented."),o.a.createElement("button",{className:"Login-button Login-mm",onClick:this.handleClick},e?"Loading...":"Login with MetaMask"),o.a.createElement("button",{className:"Login-button Login-fb",disabled:!0},"Login with Facebook"),o.a.createElement("button",{className:"Login-button Login-email",disabled:!0},"Login with Email")))}}n(359);var g=n(67),b=n.n(g),w=n(140),f=n.n(w);class k extends o.a.Component{constructor(...e){super(...e),this.state={loading:!1,user:void 0,username:""},this.handleChange=({target:{value:e}})=>{this.setState({username:e})},this.handleSubmit=()=>{const e=this.props.auth.accessToken,t=this.state,n=t.user,a=t.username;this.setState({loading:!0}),n?fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/users/").concat(n.id),{body:JSON.stringify({username:a}),headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},method:"PATCH"}).then(e=>e.json()).then(e=>this.setState({loading:!1,user:e})).catch(e=>{window.alert(e),this.setState({loading:!1})}):window.alert("The user id has not been fetched yet. Please try again in 5 seconds.")}}componentDidMount(){const e=this.props.auth.accessToken,t=b()(e).payload.id;fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/users/").concat(t),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.json()).then(e=>this.setState({user:e})).catch(window.alert)}render(){const e=this.props,t=e.auth.accessToken,n=e.onLoggedOut,a=b()(t).payload.publicAddress,s=this.state,r=s.loading,i=s.user,c=i&&i.username;return o.a.createElement("div",{className:"Profile"},o.a.createElement("p",null,"Logged in as ",o.a.createElement(f.a,{seed:a})),o.a.createElement("div",null,"My username is ",c?o.a.createElement("pre",null,c):"not set."," My publicAddress is ",o.a.createElement("pre",null,a)),o.a.createElement("div",null,o.a.createElement("label",{htmlFor:"username"},"Change username: "),o.a.createElement("input",{name:"username",onChange:this.handleChange}),o.a.createElement("button",{disabled:r,onClick:this.handleSubmit},"Submit")),o.a.createElement("p",null,o.a.createElement("button",{onClick:n},"Logout")))}}var E=n(141),v=n.n(E);const S="login-with-metamask:auth";class L extends o.a.Component{constructor(...e){super(...e),this.state={},this.handleLoggedIn=e=>{localStorage.setItem(S,JSON.stringify(e)),this.setState({auth:e})},this.handleLoggedOut=()=>{localStorage.removeItem(S),this.setState({auth:void 0})}}componentDidMount(){const e=window.localStorage.getItem(S),t=e&&JSON.parse(e);this.setState({auth:t})}render(){const e=this.state.auth;return(o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement("img",{src:v.a,className:"App-logo",alt:"logo"}),o.a.createElement("h1",{className:"App-title"},"Welcome to Login with MetaMask Demo")),o.a.createElement("div",{className:"App-intro"},e?o.a.createElement(k,{auth:e,onLoggedOut:this.handleLoggedOut}):o.a.createElement(p,{onLoggedIn:this.handleLoggedIn}))))}}Object(a.config)({path:".env.production"}),i.a.render(o.a.createElement(L,null),document.getElementById("root"))}},[[142,1,2]]]);
//# sourceMappingURL=main.dd6a366b.chunk.js.map